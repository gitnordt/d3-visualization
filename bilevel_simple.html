<!DOCTYPE html>
<meta charset="utf-8">
<style>

path {
  stroke: #fff;
  fill-rule: evenodd;
}

.sunburst-div{
height: 90%;
width:50%;
margin: 0 auto;
}


</style>
<body>
<div class="sunburst-div" id="sunburst"></div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

var margin = {top: 450, right: 380, bottom: 450, left: 380},
    radius = Math.min(margin.top, margin.right, margin.bottom, margin.left);

var x = d3.scale.linear()
    .range([0, 2 * Math.PI]);

var y = d3.scale.sqrt()
    .range([0, radius]);

var color = d3.scale.category20c();

var svg = d3.select("#sunburst").append("svg")
	.attr("width", margin.left + margin.right)
    .attr("height", margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var partition = d3.layout.partition()
    .value(function(d) { return d.size; });

var arc = d3.svg.arc()
    .startAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x))); })
    .endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x + d.dx))); })
    .innerRadius(function(d) { return Math.max(0, y(d.y)); })
    .outerRadius(function(d) { return Math.max(0, y(d.y + d.dy)); });

d3.json("flare.json", function(error, root) {
	  
	var g = svg.selectAll("g")
	  .data(partition.nodes(root))
		.enter().append("g");

	var path = g.append("path")
	  .attr("d", arc)
	  .style("fill", function(d) { return color((d.children ? d : d.parent).name); })
	  .attr("title", function(d) { var title = ""; d.depth == 0 ? title = "zoom out" : title = "zoom in"; return title; })
	  .on("click", click);
	  
	var text = g.append("text")
	  .attr("x", function(d) { return y(d.y); })
	  .attr("dx", function(d) { var horizontal = ""; d.depth == 0 ? horizontal = "-10" : horizontal = "6"; return horizontal; })
	  .attr("dy", ".35em") // vertical-align
	  .text(function(d) { return d.name; });

	function computeTextRotation(d) {
	  var angle = x(d.x + d.dx / 2) - Math.PI / 2;
	  return angle / Math.PI * 180;
	}

	text.attr("transform", function(d) { var rotate = ""; d.depth == 0 ? rotate = "rotate(0)" : rotate = "rotate(" + computeTextRotation(d) + ")"; return rotate; });	
    console.log(text);
console.log(text.width);	

	function click(d) {
	  // fade out all text elements
	  text.transition().attr("opacity", 0);

	  path.transition()
		.duration(750)
		.attrTween("d", arcTween(d))
		.each("end", function(e, i) {
			// check if the animated element's data e lies within the visible angle span given in d
			if (e.x >= d.x && e.x < (d.x + d.dx)) {
			  var arcText = d3.select(this.parentNode).select("text");
			  // fade in the text element and recalculate positions
			  arcText.transition().duration(750)
				.attr("opacity", 1)
				.attr("transform", function() { var rotate = ""; e.depth == 0 ? rotate = "rotate(0)" : rotate = "rotate(" + computeTextRotation(e) + ")"; return rotate; })
				.attr("x", function(d) { return y(d.y); });
			}
		});
	}
});

// Interpolate the scales!
function arcTween(d) {
  var xd = d3.interpolate(x.domain(), [d.x, d.x + d.dx]),
      yd = d3.interpolate(y.domain(), [d.y, 1]),
      yr = d3.interpolate(y.range(), [d.y ? 20 : 0, radius]);
  return function(d, i) {
    return i
        ? function(t) { return arc(d); }
        : function(t) { x.domain(xd(t)); y.domain(yd(t)).range(yr(t)); return arc(d); };
  };
}

d3.select(self.frameElement).style("height", margin.top + margin.bottom + "px");



</script>
