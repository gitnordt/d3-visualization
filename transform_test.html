<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
 <script src="../../templates/simple_sortable_table/jquery-1.9.1.js"></script>
<script src="../../templates/simple_sortable_table/jquery-ui.js"></script> 
<script>

 
$.getJSON("AA-software.json", function(response) {

/*data = [
 { "name" : "ABC", "parent":"DEF", "relation": "ghi", "depth": 1 },
 { "name" : "DEF", "parent":"null", "relation": "null", "depth": 0 },
 { "name" : "new_name", "parent":"ABC", "relation": "rel", "depth": 2 },
 { "name" : "new_name2", "parent":"ABC", "relation": "foo", "depth": 2 },
 { "name" : "Foo", "parent":"DEF", "relation": "rel", "depth": 2 },
 { "name" : "Bar", "parent":"null", "relation": "rel", "depth": 2 }
];*/


/*{
  "DARPA Program":"AA",
  "Program Teams":["Allure Security Technology Inc."],
  "Software":"RUU Active Authentication Sensor for Windows",
  "Public Code Repo":"anna.weeks@us.af.mil",
  "Description":"Software for collecting user OS interactions, generating a discriminitative user model, and taking appropriate masquarader mitigation and management measures for the Windows platform.",
  "License":"Government Purpose Rights (GPR)",
  "Categories":["Identify Management", "Software Analysis"]
}*/

var data = response;
//************************************************************************test 0*********************************************************************

/*
d3.select('body').append('pre')
    .text(JSON.stringify(data, null, '  '));		
	
});

d3.select('body').append('br');
d3.select('body').append('br');*/
 
//************************************************************************test 1*********************************************************************
// next = node.children[path[j]];
// create the tree array
/*var tree = [];
data.forEach(function(node) {
    // add to parent
    var parent = dataMap[node.parent];
    if (parent) {
        // create child array if it doesn't exist
        (parent.children || (parent.children = []))
            // add node to child array
            .push(node);
    } else {
        // parent is null or missing
        tree.push(node);
    }
});*/

/*d3.select('body').append('pre')
    .text(JSON.stringify(tree, null, '  '));	
	
d3.select('body').append('br');
d3.select('body').append('br');*/

//************************************************************************test 2*********************************************************************



//************************************************************************test 3*********************************************************************

 //console.log(data);

var nest = d3.nest()
    .key(function(d) { return d['DARPA Program']; })
    .key(function(d) { return d['Program Teams']; })
	.key(function(d) { return d.Software; })
    .entries(response);


d3.select('body').append('pre')
	.text(JSON.stringify(nest, null, '  '));

d3.select('body').append('br');
d3.select('body').append('br');


//************************************************************************test 4*********************************************************************
	
// create a name: node map
var dataMap = data.reduce(function(map, node) {
    map[node['DARPA Program']] = node;
	//console.log(map);
    return map;
}, {});


d3.select('body').append('pre')
	.text(dataMap);

d3.select('body').append('br');
d3.select('body').append('br');	

//************************************************************************test 5*********************************************************************
var data_translate =JSON.stringify(data, null, '  ');
data_translate = data_translate.replace(new RegExp('^\s*"', 'g'),  new RegExp('\{"name":"', 'gi'));
data_translate = data_translate.replace(new RegExp(': \{\},', 'g'),  new RegExp('\},', 'gi'));
/*data_translate = data_translate.replace(new RegExp('^\s*"', 'g'),  new RegExp('\{"name":"', 'gi'));
data_translate = data_translate.replace(new RegExp('^\s*"', 'g'),  new RegExp('\{"name":"', 'gi'));
data_translate = data_translate.replace(new RegExp('^\s*"', 'g'),  new RegExp('\{"name":"', 'gi'));*/

//console.log(data_translate);
var json = JSON.stringify(eval("(" + data_translate + ")"));

/*  ^\s*"             \{"name":"
  : \{\},           \},
  : \{\}            \}
  ": \{$            ","children":\[
  ^\s*\},           \]\},
  ^\s*\}            \]\}  */


/*d3.select('body').append('pre')
	.text(json);

d3.select('body').append('br');
d3.select('body').append('br');	*/

//************************************************************************test 6*********************************************************************
 //Program -> Software, Publications -> teams -> name of product
 
 

	
});

</script>
