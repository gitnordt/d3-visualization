<!DOCTYPE html>
<meta charset="utf-8">
<body>
<div id="json-div"></div>
<script src="http://d3js.org/d3.v3.min.js"></script>
 <script src="../../templates/simple_sortable_table/jquery-1.9.1.js"></script>
<script src="../../templates/simple_sortable_table/jquery-ui.js"></script> 
<script>

var program_nm = 'AA';

function getSoftwareData() {
var data;
    $.ajax({
        async: false,
        url: program_nm + '-software.json',
        dataType: 'json',
        success: function(response){
           data = response;
        }
    });
    return data;
}


function isInArray(value, array) {
  return array.indexOf(value) > -1;
}

var sw_data = getSoftwareData();
var _root = new Array();
var tree_branches = ["Program Teams","Categories","License"]

var _software_node = new Array();

for( branch in tree_branches){

	var values = new Array();
	var _branches = new Array();

	for (i in sw_data) {
		for(value in sw_data[i][tree_branches[branch]]){
			var data_value = sw_data[i][tree_branches[branch]][value];
			if(!isInArray(data_value, values)){
				_branches.push({"name": data_value, "size": 3938});
				values.push(data_value);
			}
		}

		if(i == sw_data.length - 1){
			var _branch_node = {"name":tree_branches[branch], "children": _branches};
			_software.push(_branch_node);
		}

	}
}

_software_node = {"name":"Software", "children": _software};
_programs.push(_software_node);
_programs.push(_root);
_program_node = {"name":program_nm, "children": _programs};
_root.push(_program_node);

var nest_string = JSON.stringify(_root, null, '  ');
nest_string = nest_string.substring(1, nest_string.length - 2);
nest_string = nest_string.replace(/"key"/g, '"name"');
nest_string = nest_string.replace(/"values"/g, '"children"');


d3.select('body').append('pre')
   .text(nest_string);

/*
var dataMap = sw_data.reduce(function(map, node) {
    map[node['AA']] = node;
	//console.log(map);
    return map;
}, {});

var tree = [];
_root.forEach(function(node) {
    // add to parent
    var parent = dataMap[node.parent];
    if (parent) {
        // create child array if it doesn't exist
        (parent.children || (parent.children = []))
            // add node to child array
            .push(node);
    } else {
        // parent is null or missing
        tree.push(node);
    }
});


//d3.select('body').append('pre')
    //.text(JSON.stringify(_root, null, '  '));	
	
	d3.select('body').append('pre')
    .text(JSON.stringify(_root));	
*/
/*var _JSON_ = JSON.stringify(_root);
$('#json-div').text(_JSON_);*/

</script>
